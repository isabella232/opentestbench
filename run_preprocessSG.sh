#    Opentestbench : an open-source framework to assess the performances of image compression schemes
#    Copyright (C) 2015  intoPIX s.a. , Sébastien Lugan 
#    Copyright (C) 2015  Universite Catholique de Louvain, Alexandre Willème
#
#    Opentestbench is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#    
#   For any question please contact : 
#   Alexandre Willème (alexandre.willeme@uclouvain.be)


#!/bin/bash
export LANG=C

#a number that is only used to identify the log of the test
testid="test"

# either singlegen multigen or errortest
test_type=multigen

#list of codecs to test 
#codecs=(j2kull)
#codecs=(jpeg)
codecs=(vc2hqcbr)
# list of bitrates to test  (in bpp)
#bitrates=(0.1)
#bitrates=(4)
bitrates=(3.3)
#bitrates=(5)
#list of pictures folder to use and the related picture format in color_spaces chroma_subs bit_depths image_sizes
#orig_dirs=(/export/image_content/JPEG_XS_test_material/sequences/APPLE_BasketBallScreen_2560x1440p_60_8b_sRGB_444)
#orig_dirs=(/export/image_content/JPEG_XS_test_material/sequences/RICHTER_ScreenContent_4096x2160p_15_8b_sRGB_444)
#orig_dirs=(/export/image_content/JPEG_XS_test_material/sequences/EBU_PendulusWide_3840x2160p_50_10b_bt709_444)
orig_dirs=(/export/image_content/JPEG_XS_test_material/sequences/ARRI_Lake2_2880x1620p_24_10b_bt709_422)
#decompressed_dirs=(/home/willeme/opentestbench/results/multi_generation/j2kull/APPLE_BasketBallScreen_2560x1440p_60_8b_sRGB_444_sb100_j2kull_0_1bpp_r7)
#decompressed_dirs=(/export/home/willeme/JPEGXSGENEVE_RESULTS/results/subjective/jpeg/APPLE_BasketBallScreen_2560x1440p_60_8b_sRGB_444_sb1_jpeg_4bpp_r7)
#decompressed_dirs=(/export/home/willeme/JPEGXSGENEVE_RESULTS/results/subjective/vc2hqcbr/RICHTER_ScreenContent_4096x2160p_15_8b_sRGB_444_sb1_vc2hqcbr_4bpp_r7)
#decompressed_dirs=(/home/willeme/JPEGXSGENEVE_RESULTS/results/subjective/vc2hqcbr/EBU_PendulusWide_3840x2160p_50_10b_bt709_444_subj_sb1_vc2hqcbr_5bpp_r7)
decompressed_dirs=(/export/home/willeme/JPEGXSGENEVE_RESULTS/results/subjective/vc2hqcbr/ARRI_Lake2_2880x1620p_24_10b_bt709_422_sb1_vc2hqcbr_3_3bpp_r7)
flickering_periods=(10)
decompressed_sides=(left)
xpos_crop=(1000)
# either RGB or YCbCr
#color_spaces=(RGB)
color_spaces=(YCbCr)
# either 444 or 422
#chroma_subs=(444)
chroma_subs=(422)
# either 8, 10 or 12 bits
bit_depths=(10)
# WIDTHxHEIGHT
#image_sizes=(2560x1440)
#image_sizes=(4096x2160)
#image_sizes=(3840x2160)
image_sizes=(2880x1620)
# only used for multigen : number of encoding/decoding cycles to perform
niter=7
# only used for multigen : =1 if the comparison must be made wrt the original picture and =0 if the comparison is made wrt the input of each generation
comparison_with_original=1


#-----------------------------------------------------------------------------

source benchmark/paths.sh
mkdir -p log_files
logfile="./log_files/log_preprocess_${testid}.dat"
echo -n "" >  ${logfile}
for ((a=0; a<${#codecs[@]}; ++a)); do
    for ((b=0; b<${#decompressed_dirs[@]}; ++b)); do
        for ((c=0; c<${#bitrates[@]}; ++c)); do
					echo "Pre-processing step: ${test_type} codec ${codecs[$a]} bitrate ${bitrates[$c]} decompressed_dirs ${decompressed_dirs[$b]}"
					echo -n "Pre-processing step: ${test_type} codec ${codecs[$a]} bitrate ${bitrates[$c]} decompressed_dirs ${decompressed_dirs[$b]}" >> ${logfile}
					bash preprocess/preprocess.sh ${test_type} ${codecs[$a]} ${bitrates[$c]} ${orig_dirs[$b]} ${decompressed_dirs[$b]} ${color_spaces[$b]} ${chroma_subs[$b]} ${bit_depths[$b]} ${image_sizes[$b]} ${flickering_periods[$b]} ${decompressed_sides[$b]} ${xpos_crop[$b]} 1>>${logfile} 2>>${logfile}
        done
    done
done
