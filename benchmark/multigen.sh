#    Opentestbench : an open-source framework to assess the performances of image compression schemes
#    Copyright (C) 2015  intoPIX s.a. , Sébastien Lugan 
#    Copyright (C) 2018  Universite Catholique de Louvain, Alexandre Willème
#
#    Opentestbench is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#    
#   For any question please contact : 
#   Alexandre Willème (alexandre.willeme@uclouvain.be)


#!/bin/bash
export LANG=C

source benchmark/paths.sh

# usage:
# multigen.sh codec bitrate src_dir niter

codec=$1
bpp=$2
src_dir=$3
niter=$4

if [ -z ${codec} ] || [ -z ${bpp} ] || [ -z ${src_dir} ] || [ -z ${niter} ]; then
  echo usage multigen.sh codec bitrate src_dir niter
  exit 1
fi

mkdir -p results/multi_generation/${codec}
output_dir=results/multi_generation/${codec}
short_name=${src_dir##*/}

for ((r=1;r<=niter;++r)); do
	echo iteration number ${r}
	name=${short_name}_${codec}_${bpp/./_}bpp_r${r}
	name_previous=${short_name}_${codec}_${bpp/./_}bpp_r$(($r - 1))
	if [ $r = 1 ]; then
		input_dir=${src_dir}
	else
		input_dir=${output_dir}/${name_previous}
	fi
	bash benchmark/gen.sh ${name} ${codec} ${bpp} ${input_dir} ${src_dir} ${output_dir}
    #if [ $r -gt 1 ]; then
    #    rm -rfv ${output_dir}/${name_previous}
    #fi
done
#   move the last one also
#rm -rfv ${output_dir}/${name}
