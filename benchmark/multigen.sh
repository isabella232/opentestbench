#    Opentestbench : an open-source framework to assess the performances of image compression schemes
#    Copyright (C) 2015  intoPIX s.a. , Sébastien Lugan 
#    Copyright (C) 2015  Universite Catholique de Louvain, Alexandre Willème
#
#    Opentestbench is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#    
#   For any question please contact : 
#   Alexandre Willème (alexandre.willeme@uclouvain.be)


#!/bin/bash
export LANG=C

source benchmark/paths.sh

# usage:
#  multigen.sh codec bitrate src_dir color_space chroma_sub bit_depth image_size niter comparison_with_original

codec=$1
bpp=$2
src_dir=$3
color_space=$4
chroma_sub=$5
bit_depth=$6
image_size=$7
niter=$8
comparison_with_original=$9

if [ -z ${codec} ] || [ -z ${bpp} ] || [ -z ${src_dir} ] || [ -z ${color_space} ] || [ -z ${chroma_sub} ] || [ -z ${bit_depth} ] || [ -z ${image_size} ] || [ -z ${niter} ] || [ -z ${comparison_with_original} ]; then
  echo usage multigen.sh codec bitrate src_dir color_space chroma_sub bit_depth image_size niter comparison_with_original
  exit 1
fi

mkdir -p results/multi_generation/${codec}
output_dir=results/multi_generation/${codec}
short_name=${src_dir##*/}

for ((r=1;r<=niter;++r)); do
	echo iteration number ${r}
	name=${short_name}_${codec}_${bpp}bpp_${color_space}_${chroma_sub}_${bit_depth}b_${image_size}_r${r}
	name_previous=${short_name}_${codec}_${bpp}bpp_${color_space}_${chroma_sub}_${bit_depth}b_${image_size}_r$(($r - 1))
    if [ $r = 1 ]; then
      input_dir=${src_dir}
    else
      input_dir=${output_dir}/${name_previous}
    fi
    if [ $comparison_with_original = 1 ]; then
				bash benchmark/gen.sh ${name} ${codec} ${bpp} ${input_dir} ${src_dir} ${color_space} ${chroma_sub} ${bit_depth} ${image_size} ${output_dir}
    else
        bash benchmark/gen.sh ${name} ${codec} ${bpp} ${input_dir} ${input_dir} ${color_space} ${chroma_sub} ${bit_depth} ${image_size} ${output_dir}
    fi
#   make a little room
    #if [ $r -gt 1 ]; then
        #rm -rfv ${output_dir}/${name_previous}
    #fi
done
#   move the last one also
#rm -rfv ${output_dir}/${name}
