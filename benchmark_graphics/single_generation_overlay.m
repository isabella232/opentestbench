close all
arrayEncDecOverlay = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayEncDecOverlay0 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayEncDecOverlay1 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayEncDecOverlay2 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));

arrayOverlayEncDec = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayOverlayEncDec0 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayOverlayEncDec1 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));
arrayOverlayEncDec2 = zeros(size(codecs,2),size(picture_set,2),size(bitrates,2));


seqname = repmat({'TEST'}, size(codecs,2),size(picture_set,2),size(bitrates,2));


 for i=1:size(codecs,2)
     for a=1:size(picture_set,2)
          for q=1:size(bitrates,2)
              filename = strcat('../results/single_generation_overlay/',codecs{i},'_',overlay_configs{i},'/psnr_',picture_set{a},'_sb',content_dirs_sb_factors{a},'_',overlay_configs{i},'_',codecs{i},'_',num2str(bitrates(q)),'bpp_r1.dat');
							seqname{i,a,q} = strcat(picture_set{a},'_sb',content_dirs_sb_factors{a},'_',overlay_configs{i},'_',codecs{i},'_',num2str(bitrates(q)),'bpp_r1');
              
              if exist(filename, 'file') == 2
                  contentTable = readtable(filename,'ReadVariableNames',false,'Delimiter',' ');
									name=contentTable{:,1};
									toDelete=find(ismember(name, '!!!'));

									PSNR = contentTable{:,2};

									PSNR0 = contentTable{:,3};
									PSNR1 = contentTable{:,4};
									PSNR2 = contentTable{:,5};

									PSNR(toDelete) = [];
									PSNR0(toDelete) = [];
									PSNR1(toDelete) = [];
									PSNR2(toDelete) = [];
									name(toDelete) = [];
									if(strcmp(name(size(PSNR,1)),'NumberSizeExceeded'))
										numberExceed = PSNR(size(PSNR,1));
										PSNR = PSNR(1:size(PSNR,1)-1);
										PSNR0 = PSNR0(1:size(PSNR0,1)-1);
										PSNR1 = PSNR1(1:size(PSNR1,1)-1);
										PSNR2 = PSNR2(1:size(PSNR2,1)-1);
									else
										numberExceed = NaN;
									end
									if size(contentTable,2) >= 7
										realSizes = contentTable{:,6};
										realSizes = realSizes(1:size(realSizes,1)-1);
										realSizes(toDelete) = [];
										targetSizes = contentTable{:,7};
										targetSizes = targetSizes(1:size(targetSizes,1)-1);
										targetSizes(toDelete) = [];
										%numberExceed = nnz(targetSizes < realSizes);
									end
									
                    if(bit_depths{a} == '10')
													dynamic = 1024-1;
										elseif(bit_depths{a} == '8')
													dynamic = 256-1;
										elseif(bit_depths{a} == '12')
													dynamic = 2^12-1;
										end	

									arrayEncDecOverlay(i,a,q) = PSNR(1);
									arrayOverlayEncDec(i,a,q) = PSNR(2);
									arrayEncDecOverlay0(i,a,q) = PSNR0(1);
									arrayOverlayEncDec0(i,a,q)= PSNR0(2);
									arrayEncDecOverlay1(i,a,q) = PSNR1(1);
									arrayOverlayEncDec1(i,a,q)= PSNR1(2);
									arrayEncDecOverlay2(i,a,q) = PSNR2(1);
									arrayOverlayEncDec2(i,a,q)= PSNR2(2);

              else
                  arrayEncDecOverlay(i,a,q) =0;
                  arrayEncDecOverlay0(i,a,q) =0;
                  arrayEncDecOverlay1(i,a,q) =0;
                  arrayEncDecOverlay2(i,a,q) =0;
                  arrayOverlayEncDec(i,a,q) =0;
                  arrayOverlayEncDec0(i,a,q) =0;
                  arrayOverlayEncDec1(i,a,q) =0;
                  arrayOverlayEncDec2(i,a,q) =0;
                  disp(strcat(filename,' unavailable'));
              end
          end          
     end
 end
 
arrayEncDecOverlayGraph = arrayEncDecOverlay;
if(bit_depths{a} == '10')
      arrayEncDecOverlayGraph(arrayEncDecOverlayGraph==Inf) = 136; 		
elseif(bit_depths{a} == '8')
      arrayEncDecOverlayGraph(arrayEncDecOverlayGraph==Inf) = 125; %125dB corresponds to inf
elseif(bit_depths{a} == '12')
      arrayEncDecOverlayGraph(arrayEncDecOverlayGraph==Inf) = 141; %125dB corresponds to inf
end	

arrayOverlayEncDecGraph = arrayOverlayEncDec;
if(bit_depths{a} == '10')
      arrayOverlayEncDecGraph(arrayOverlayEncDecGraph==Inf) = 136; 		
elseif(bit_depths{a} == '8')
      arrayOverlayEncDecGraph(arrayOverlayEncDecGraph==Inf) = 125; %125dB corresponds to inf
elseif(bit_depths{a} == '12')
      arrayOverlayEncDecGraph(arrayOverlayEncDecGraph==Inf) = 141; %125dB corresponds to inf
end	

 
mkdir('../graphics/single_generation_overlay');
for i=1:size(codecs,2)
		codecs_legend{2*(i-1)+1} = strrep(strcat(codecs{i},' EncDec then OL'), '_', '\_');
		codecs_legend{2*(i-1)+2} = strrep(strcat(codecs{i},' OL then EncDec'), '_', '\_');
end

picture_set_titles=strrep(picture_set, '_', '\_');

charttype = {'-o' '-+'  '-*' '-x' '-s' '-d' '-^' '-v' '-<' '->' ':o' ':p' ':h'};
%for value for each image set
  for a=1:size(picture_set,2)
      fig = figure;
			set(fig, 'OuterPosition', [50 50 1600 900]);
      xlabel('Output bitrates (in bpp)','Fontsize',14);
      ylabel('PSNR (in dB)','Fontsize',14);        
      for i=1:size(codecs,2)
          plotEncDecOverlay = squeeze(arrayEncDecOverlayGraph(i,a,:));
          plotBitrates = bitrates;
          ix=(plotEncDecOverlay == 0);
          plotEncDecOverlay(ix)=[];    
          plotBitrates(ix)=[];
          hold on
          plot(plotBitrates,plotEncDecOverlay,charttype{2*(i-1)+1},'LineWidth',2);

          plotOverlayEncDec = squeeze(arrayOverlayEncDecGraph(i,a,:));
          plotBitrates = bitrates;
          ix=(plotOverlayEncDec == 0);
          plotOverlayEncDec(ix)=[];    
          plotBitrates(ix)=[];
          hold on
          plot(plotBitrates,plotOverlayEncDec,charttype{2*(i-1)+2},'LineWidth',2);
      end
			grid on;
xlim([3 14]);
			%axis(axislimit(a,:));
			legend(codecs_legend{:},'Location','northwest','Fontsize',12);
			%legend(codecs_legend{:},'Location','eastoutside','Fontsize',12);
      title(strcat('E6 experiment results for image set "',picture_set_titles{a},'"'));
			filename=strcat('../graphics/single_generation_overlay/E6_',codecs{i},'_',picture_set{a},'.png');
			set(gca,'fontsize',14);
			mystyle = hgexport('factorystyle');
			mystyle.Width = 1600;
			mystyle.Height = 900;
			mystyle.Units = 'pixels';
			mystyle.Resolution = 200;
			hgexport(gcf, filename, mystyle, 'Format', 'png');
  end






