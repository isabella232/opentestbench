from __future__ import division
from math import log10
from bjontegaard_metric import *
import csv 
import time
import os 
import os.path
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.colors as colors


def BD_PSNR(R1, PSNR1, R2, PSNR2):
  lR1 = np.log(R1);
  lR2 = np.log(R2);
	#for polynomial fit
  p1 = np.polyfit(lR1, PSNR1, len(R1)-1)
  p2 = np.polyfit(lR2, PSNR2, len(R2)-1)

  # to plot
  #p1array = np.poly1d(p1)
  #p2array = np.poly1d(p2)
  #xp = np.linspace(lR1[0], lR1[3], 100)
  #_ = plt.plot(lR1,PSNR1,'.',lR2,PSNR2,'.',xp,p1array(xp),'-',xp,p2array(xp),'--')
  #plt.show()

  # integration interval
  min_int = max(min(lR1), min(lR2))
  max_int = min(max(lR1), max(lR2))

  # find integral
  p_int1 = np.polyint(p1)
  p_int2 = np.polyint(p2)

  int1 = np.polyval(p_int1, max_int) - np.polyval(p_int1, min_int)
  int2 = np.polyval(p_int2, max_int) - np.polyval(p_int2, min_int)

  # find avg diff
  avg_diff = (int2-int1)/(max_int-min_int)

  return avg_diff

def BD_RATE(R1, PSNR1, R2, PSNR2):
  lR1 = np.log(R1)
  lR2 = np.log(R2)

  # rate method
  p1 = np.polyfit(PSNR1, lR1, len(R1)-1)
  p2 = np.polyfit(PSNR2, lR2, len(R2)-1)

  # integration interval
  min_int = max(min(PSNR1), min(PSNR2))
  max_int = min(max(PSNR1), max(PSNR2))

  # find integral
  p_int1 = np.polyint(p1)
  p_int2 = np.polyint(p2)

  int1 = np.polyval(p_int1, max_int) - np.polyval(p_int1, min_int)
  int2 = np.polyval(p_int2, max_int) - np.polyval(p_int2, min_int)

  # find avg diff
  avg_exp_diff = (int2-int1)/(max_int-min_int)
  avg_diff = (np.exp(avg_exp_diff)-1)*100
  return avg_diff




