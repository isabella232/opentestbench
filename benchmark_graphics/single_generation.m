close all

mystyle = hgexport('factorystyle');
mystyle.Width = 10;
mystyle.Height = 6.6;
mystyle.Units = 'inches';
mystyle.Resolution = 200;

filename = strcat('../results/single_generation/',codecs{1},'/psnr_',picture_set,'_',codecs{1},'_',num2str(bitrates(1)),'bpp_r1.dat');
contentTable = readtable(filename,'ReadVariableNames',false,'Delimiter',' ');
name=contentTable{:,1};
numberPic=size(name,1)-1;
arrayPSNR = zeros(size(codecs,2),numberPic,size(bitrates,2));
arrayMeanPSNR = zeros(size(codecs,2),size(bitrates,2));

 for i=1:size(codecs,2)
          for q=1:size(bitrates,2)
              filename = strcat('../results/single_generation/',codecs{i},'/psnr_',picture_set,'_',codecs{i},'_',num2str(bitrates(q)),'bpp_r1.dat');
              if exist(filename, 'file') == 2
                    contentTable = readtable(filename,'ReadVariableNames',false,'Delimiter',' ');
                    names=contentTable{:,1};
                    toDelete=find(ismember(names, '!!!'));

                    PSNR = contentTable{:,2};

                    PSNR(toDelete) = [];
                    names(toDelete) = [];
                    if(strcmp(name(size(PSNR,1)),'NumberSizeExceeded'))
                        numberExceed = PSNR(size(PSNR,1));
                        PSNR = PSNR(1:size(PSNR,1)-1);
			names = names(1:size(names,1)-1);
                    else
                        numberExceed = NaN;
                    end
                    if size(contentTable,2) >= 7
                        realSizes = contentTable{:,6};
                        realSizes = realSizes(1:size(realSizes,1)-1);
                        realSizes(toDelete) = [];
                        targetSizes = contentTable{:,7};
                        targetSizes = targetSizes(1:size(targetSizes,1)-1);
                        targetSizes(toDelete) = [];
                        %numberExceed = nnz(targetSizes < realSizes);
                    end
                        
                        arrayPSNR(i,:,q)=PSNR; 
                        
                        meanPSNR = mean(PSNR);
                        arrayMeanPSNR(i,q) = meanPSNR;
              else
                        arrayMeanPSNR(i,q) = 0;
                        disp(strcat(filename,' unavailable'));
              end    
     end
 end
 
picture_titles=strrep(names, '_', '\_');
mkdir('../graphics/single_generation');
codecs_legend = strrep(codecs, '_', '\_');
charttype = {'-o' '-+'  '-*' '-x' '-s' '-d' '-^' '-v' '-<' '->' ':o' ':p' ':h'};

for a=1:size(names,1)
    fig = figure;
    set(fig, 'OuterPosition', [50 50 1800 900]);
    xlabel('Output bitrates (in bpp)','Fontsize',14);
    ylabel('PSNR (in dB)','Fontsize',14);        
    for i=1:size(codecs,2)
        plotMean = squeeze(arrayPSNR(i,a,:));
        plotBitrates = bitrates;
        hold on
        plot(plotBitrates,plotMean,charttype{i},'LineWidth',2);
    end
    grid on;
    %xlim([3 14]);
    %axis(axislimit(a,:));
    %legend(codecs_legend{:},'Location','northeast','Fontsize',26);
    legend(codecs_legend{:},'Location','eastoutside','Fontsize',26);
    [filepath,pictitle,ext] = fileparts(picture_titles{a});
    [filepath,picname,ext] = fileparts(names{a});
    title(strcat('Single gen for image "',pictitle,'" at gen.',{' '},num2str(gen_number)));
    filename=strcat(path{1},'/',picname,'_g',num2str(gen_number),'.png');
    filename
    set(gca,'fontsize',26);
    hgexport(gcf, filename, mystyle, 'Format', 'png');
    close;
end

fig = figure;
set(fig, 'OuterPosition', [50 50 1800 900]);
xlabel('Output bitrates (in bpp)','Fontsize',14);
ylabel('PSNR (in dB)','Fontsize',14);        
for i=1:size(codecs,2)
    plotMean = squeeze(arrayMeanPSNR(i,:));
    plotBitrates = bitrates;
    hold on
    plot(plotBitrates,plotMean,charttype{i},'LineWidth',2);
end
grid on;
%xlim([3 14]);
%axis(axislimit(a,:));
%legend(codecs_legend{:},'Location','northeast','Fontsize',26);
legend(codecs_legend{:},'Location','eastoutside','Fontsize',26);
[filepath,pictitle,ext] = fileparts(picture_titles{a});
[filepath,picname,ext] = fileparts(names{a});
title(strcat('Single gen for set',{' '},picture_set,{' '},'at gen.',{' '},num2str(gen_number)));
filename=strcat(path{1},'/',picture_set,'_g',num2str(gen_number),'.png');
set(gca,'fontsize',26);
hgexport(gcf, filename, mystyle, 'Format', 'png');
close;
