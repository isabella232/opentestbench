close all

codecs_legend = strrep(codecs, '_', '\_');
codecs_legend = strrep(codecs_legend, 'hevc', 'hevc (not CBR and low-latency)');
codecs_legend = strrep(codecs_legend, 'j2kbc\_PSNR', 'j2kbc\_PSNR (not CBR and low-latency)');
codecs_legend = strrep(codecs_legend, 'jpeg', 'jpeg (not CBR and low-latency)');
picture_set_titles=strrep(picture_set, '_', '\_');
charttype = {'-o' '-+'  '-*' '-x' '-s' '-d' '-^' '-v' '-<' '->' ':o' ':p' ':h'};

for a=1:size(picture_set,2)
		outputdir = strcat('../graphics/single_generation_frame_index/',picture_set{a});
		mkdir(outputdir);
    for q=1:size(bitrates,2)
					fig = figure;
					%set(fig, 'Position', [800 800 950 600]);
					set(fig, 'OuterPosition', [50 50 1600 900]);
					xlabel('Frame #','Fontsize',14);
					ylabel('PSNR (in dB)','Fontsize',14); 
				 	for i=1:size(codecs,2)
		        filename = strcat('../results/single_generation/',codecs{i},'/psnr_',picture_set{a},'_sb',content_dirs_sb_factors{a},'_',codecs{i},'_',num2str(bitrates(q)),'bpp_r1.dat');        
		        if exist(filename, 'file') == 2
		            contentTable = readtable(filename,'ReadVariableNames',false,'Delimiter',' ');
								name=contentTable{:,1};
								toDelete=find(ismember(name, '!!!'));
								%if chroma_subs{a} == '422';
		            %	PSNR = contentTable{:,3};
								%else
									PSNR = contentTable{:,2};
								%end
								PSNR(toDelete) = [];
								name(toDelete) = [];
								if(strcmp(name(size(PSNR,1)),'NumberSizeExceeded'))
									numberExceed = PSNR(size(PSNR,1));
									PSNR = PSNR(1:size(PSNR,1)-1);
								else
									numberExceed = NaN;
								end
								if size(contentTable,2) >= 7
									realSizes = contentTable{:,6};
									realSizes = realSizes(1:size(realSizes,1)-1);
									realSizes(toDelete) = [];
									targetSizes = contentTable{:,7};
									targetSizes = targetSizes(1:size(targetSizes,1)-1);
									targetSizes(toDelete) = [];
									%numberExceed = nnz(targetSizes < realSizes);
								end
					
		              if(bit_depths{a} == '10')
												dynamic = 1024-1;
									elseif(bit_depths{a} == '8')
												dynamic = 256-1;
									elseif(bit_depths{a} == '12')
												dynamic = 2^12-1;
									end	

								if(bit_depths{a} == '10')
		                    PSNR(PSNR==Inf) = 136; 		
									elseif(bit_depths{a} == '8')
		                    PSNR(PSNR==Inf) = 125; %125dB corresponds to inf
									elseif(bit_depths{a} == '12')
		                    PSNR(PSNR==Inf) = 141; %125dB corresponds to inf
									end	
		            %disp(strcat('ok',codecs{i},picture_set{a},num2str(bitrates(q))));  
		        else
		            disp(strcat(filename,' unavailable'));
								PSNR = zeros(1);
		        end
				    plotNum = 1:1:size(PSNR,1);
				    ix=(PSNR == 0);
				    PSNR(ix)=[];    
				    plotNum(ix)=[];
				    hold on
				    plot(plotNum,PSNR,charttype{i},'LineWidth',2);			
				end
				grid on;
				xlim([1 size(PSNR,1)])
		    %		legend(codecs_legend{:},'Location','NorthEast','Fontsize',12);
				legend(codecs_legend{:},'Location','eastoutside','Fontsize',12);
		    title(strcat('Single generation results for image set "',picture_set_titles{a},{'" at '},num2str(bitrates(q)),' bpp'));
				filename=strcat(outputdir,'/',picture_set{a},'@',num2str(bitrates(q)),'bpp.jpeg');
				set(gca,'fontsize',14);
			set(gca,'fontsize',14);
			mystyle = hgexport('factorystyle');
			mystyle.Width = 1600;
			mystyle.Height = 900;
			mystyle.Units = 'pixels';
			mystyle.Resolution = 200;
				hgexport(gcf, filename, mystyle, 'Format', 'jpeg');
				close;
    end
end
 




